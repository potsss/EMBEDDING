# å¤šæ¨¡æ€ç”¨æˆ·åµŒå…¥è¡¨ç¤ºå­¦ä¹ é¡¹ç›®

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªåŸºäºå¤šæ¨¡æ€æ•°æ®çš„ç”¨æˆ·åµŒå…¥è¡¨ç¤ºå­¦ä¹ ç³»ç»Ÿï¼Œç»“åˆç”¨æˆ·è¡Œä¸ºåºåˆ—ï¼ˆåŸºäºNode2Vec/Item2Vecï¼‰ã€ç”¨æˆ·å±æ€§å’Œä½ç½®ä¿¡æ¯ï¼Œç”Ÿæˆç»¼åˆçš„ç”¨æˆ·å‘é‡è¡¨ç¤ºã€‚

## ğŸš€ é¡¹ç›®ç‰¹æ€§

- **å¤šæ¨¡æ€èåˆ**: ç»“åˆè¡Œä¸ºã€å±æ€§ã€ä½ç½®ä¸‰ç§æ¨¡æ€çš„ç”¨æˆ·è¡¨ç¤º
- **çµæ´»çš„æ¨¡å‹é€‰æ‹©**: æ”¯æŒNode2Vecå’ŒItem2Vecä¸¤ç§åºåˆ—å»ºæ¨¡æ–¹æ³•
- **æ™ºèƒ½æ•°æ®è¿‡æ»¤**: è‡ªåŠ¨è¿‡æ»¤æ–°ç”¨æˆ·æ•°æ®ä¸­ä¸å­˜åœ¨äºè®­ç»ƒé›†çš„å®ä½“
- **å…¼å®¹æ€§æ£€æŸ¥**: è‡ªåŠ¨ç”Ÿæˆæ•°æ®å…¼å®¹æ€§æŠ¥å‘Šï¼Œè¯„ä¼°æ•°æ®è´¨é‡
- **å®Œæ•´çš„è®­ç»ƒæµç¨‹**: ä»æ•°æ®é¢„å¤„ç†åˆ°æ¨¡å‹è®­ç»ƒçš„ç«¯åˆ°ç«¯è§£å†³æ–¹æ¡ˆ
- **æ–°ç”¨æˆ·æ¨ç†**: æ”¯æŒä¸ºæ–°ç”¨æˆ·è®¡ç®—å‘é‡è¡¨ç¤º
- **å®éªŒç®¡ç†**: å®Œæ•´çš„å®éªŒé…ç½®å’Œç»“æœç®¡ç†ç³»ç»Ÿ

## ğŸ“ é¡¹ç›®ç»“æ„

```
embeddingé¡¹ç›®/
â”œâ”€â”€ main.py                    # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ config.py                  # é…ç½®æ–‡ä»¶
â”œâ”€â”€ data_preprocessing.py      # æ•°æ®é¢„å¤„ç†æ¨¡å—
â”œâ”€â”€ model.py                   # æ¨¡å‹å®šä¹‰
â”œâ”€â”€ trainer.py                 # è®­ç»ƒå™¨
â”œâ”€â”€ compute_new_users.py       # æ–°ç”¨æˆ·å‘é‡è®¡ç®—ï¼ˆç‹¬ç«‹è„šæœ¬ï¼‰
â”œâ”€â”€ check_new_user_data.py     # æ–°ç”¨æˆ·æ•°æ®å…¼å®¹æ€§æ£€æŸ¥å·¥å…·
â”œâ”€â”€ train_label_discriminator.py  # æ ‡ç­¾åˆ¤åˆ«å™¨è®­ç»ƒ
â”œâ”€â”€ requirements.txt           # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ README.md                  # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ data/                      # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ user_behavior.csv      # ç”¨æˆ·è¡Œä¸ºæ•°æ®
â”‚   â”œâ”€â”€ user_attributes.tsv    # ç”¨æˆ·å±æ€§æ•°æ®
â”‚   â”œâ”€â”€ user_base_stations.tsv # ç”¨æˆ·ä½ç½®æ•°æ®
â”‚   â”œâ”€â”€ new_user_behavior.csv  # æ–°ç”¨æˆ·è¡Œä¸ºæ•°æ®
â”‚   â”œâ”€â”€ new_user_attributes.tsv # æ–°ç”¨æˆ·å±æ€§æ•°æ®
â”‚   â””â”€â”€ new_user_base_stations.tsv # æ–°ç”¨æˆ·ä½ç½®æ•°æ®
â””â”€â”€ experiments/               # å®éªŒç»“æœç›®å½•
    â””â”€â”€ {experiment_name}/     # å…·ä½“å®éªŒç›®å½•
        â”œâ”€â”€ processed_data/    # é¢„å¤„ç†åçš„æ•°æ®
        â”‚   â”œâ”€â”€ training_entities.pkl # è®­ç»ƒå®ä½“è®°å½•
        â”‚   â””â”€â”€ new_user_compatibility_report.json # å…¼å®¹æ€§æŠ¥å‘Š
        â”œâ”€â”€ models/           # ä¿å­˜çš„æ¨¡å‹
        â”œâ”€â”€ checkpoints/      # è®­ç»ƒæ£€æŸ¥ç‚¹
        â”œâ”€â”€ logs/            # è®­ç»ƒæ—¥å¿—
        â””â”€â”€ visualizations/  # å¯è§†åŒ–ç»“æœ
```

## ğŸ› ï¸ å®‰è£…å’Œç¯å¢ƒè®¾ç½®

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- PyTorch 1.9+
- pandas, numpy, scikit-learn
- sentence-transformersï¼ˆç”¨äºæ–‡æœ¬åµŒå…¥ï¼‰

### å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

## ğŸ“Š æ•°æ®æ ¼å¼

### ç”¨æˆ·è¡Œä¸ºæ•°æ® (user_behavior.csv)
```csv
user_id,timestamp,url,duration
user_001,2023-01-01 10:00:00,example.com,120
user_001,2023-01-01 10:05:00,news.com,300
```

### ç”¨æˆ·å±æ€§æ•°æ® (user_attributes.tsv)
```tsv
user_id	age	gender	city	income_level	education	occupation	device_type
user_001	25	M	Beijing	high	bachelor	engineer	mobile
```

### ç”¨æˆ·ä½ç½®æ•°æ® (user_base_stations.tsv)
```tsv
user_id	timestamp	base_station_id	duration
user_001	2023-01-01 10:00:00	BS_001	1800
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. æ•°æ®é¢„å¤„ç†
```bash
python main.py --mode preprocess --experiment_name my_experiment
```

### 2. æ¨¡å‹è®­ç»ƒ
```bash
# å®Œæ•´è®­ç»ƒï¼ˆè¡Œä¸º+å±æ€§+ä½ç½®ï¼‰
python main.py --mode train --experiment_name my_experiment

# ä»…è¡Œä¸ºæ¨¡å‹
python main.py --mode train --experiment_name my_experiment --disable_attributes --disable_location
```

### 3. æ–°ç”¨æˆ·å‘é‡è®¡ç®—

#### æ–¹æ³•1: ä½¿ç”¨ä¸»ç¨‹åºï¼ˆæ¨èï¼‰
```bash
python main.py --mode compute_new_users --experiment_name my_experiment
```

#### æ–¹æ³•2: ä½¿ç”¨ç‹¬ç«‹è„šæœ¬
```bash
python compute_new_users.py --experiment_path experiments/my_experiment
```

**ğŸ†• æ–°å¢åŠŸèƒ½**: åœ¨è®¡ç®—æ–°ç”¨æˆ·å‘é‡æ—¶ï¼Œç³»ç»Ÿä¼šï¼š
1. **è‡ªåŠ¨è¿‡æ»¤æ•°æ®**: åŸºäºè®­ç»ƒæ—¶ä¿å­˜çš„å®ä½“è®°å½•ï¼Œè¿‡æ»¤æ‰æ–°ç”¨æˆ·æ•°æ®ä¸­ä¸å­˜åœ¨çš„URLå’ŒåŸºç«™
2. **ç”Ÿæˆå…¼å®¹æ€§æŠ¥å‘Š**: è‡ªåŠ¨ç”Ÿæˆè¯¦ç»†çš„æ•°æ®å…¼å®¹æ€§æŠ¥å‘Šå¹¶ä¿å­˜ä¸ºJSONæ–‡ä»¶
3. **æä¾›è¿‡æ»¤ç»Ÿè®¡**: æ˜¾ç¤ºè¿‡æ»¤äº†å¤šå°‘è®°å½•ï¼Œå“ªäº›å®ä½“æ˜¯æœªçŸ¥çš„

#### å…¼å®¹æ€§æŠ¥å‘Šå†…å®¹
æŠ¥å‘Šä¿å­˜åœ¨ `experiments/{experiment_name}/processed_data/new_user_compatibility_report.json`ï¼ŒåŒ…å«ï¼š
- **å®éªŒä¿¡æ¯**: æ•°æ®è·¯å¾„ã€è®­ç»ƒå®ä½“æ•°é‡
- **å¤„ç†ç»“æœç»Ÿè®¡**: æˆåŠŸå¤„ç†çš„ç”¨æˆ·æ•°é‡ã€å¹³å‡åºåˆ—é•¿åº¦ã€æ•°æ®è¦†ç›–ç‡
- **è¡Œä¸ºæ•°æ®åˆ†æ**: URLè¿‡æ»¤ç»Ÿè®¡ã€æœªçŸ¥URLåˆ—è¡¨ã€è¦†ç›–ç‡
- **ä½ç½®æ•°æ®åˆ†æ**: åŸºç«™è¿‡æ»¤ç»Ÿè®¡ã€æœªçŸ¥åŸºç«™åˆ—è¡¨ã€è¦†ç›–ç‡
- **å…¼å®¹æ€§è¯„ä¼°**: æ€»ä½“å…¼å®¹æ€§è¯„åˆ†ã€è¯„çº§å’Œæ”¹è¿›å»ºè®®

### 4. æ•°æ®å…¼å®¹æ€§æ£€æŸ¥å·¥å…·

å¦‚éœ€å•ç‹¬æ£€æŸ¥æ–°ç”¨æˆ·æ•°æ®çš„å…¼å®¹æ€§ï¼Œå¯ä½¿ç”¨ä¸“ç”¨å·¥å…·ï¼š

```bash
# æ£€æŸ¥é»˜è®¤æ•°æ®æ–‡ä»¶
python check_new_user_data.py --experiment_name my_experiment

# æ£€æŸ¥è‡ªå®šä¹‰æ•°æ®æ–‡ä»¶
python check_new_user_data.py --experiment_name my_experiment \
    --new_user_behavior_path data/custom_behavior.csv \
    --new_user_location_path data/custom_location.tsv
```

è¯¥å·¥å…·ä¼šç”Ÿæˆè¯¦ç»†çš„å…¼å®¹æ€§æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š
- æ•°æ®è¦†ç›–ç‡åˆ†æ
- æœªçŸ¥å®ä½“åˆ—è¡¨
- ç”¨æˆ·çº§åˆ«ç»Ÿè®¡
- æ€»ä½“å…¼å®¹æ€§è¯„åˆ†å’Œè¯„çº§
- å…·ä½“çš„æ”¹è¿›å»ºè®®

## âš™ï¸ é…ç½®å‚æ•°

ä¸»è¦é…ç½®å‚æ•°åœ¨ `config.py` ä¸­ï¼š

```python
# æ¨¡å‹é…ç½®
MODEL_TYPE = 'node2vec'  # 'node2vec' æˆ– 'item2vec'
EMBEDDING_DIM = 128
FINAL_USER_EMBEDDING_DIM = 256

# è®­ç»ƒé…ç½®  
EPOCHS = 10
LEARNING_RATE = 0.001
BATCH_SIZE = 256

# å¤šæ¨¡æ€é…ç½®
ENABLE_ATTRIBUTES = True
ENABLE_LOCATION = True

# Node2Vecå‚æ•°
NUM_WALKS = 4
WALK_LENGTH = 20
P_PARAM = 1.0
Q_PARAM = 1.0
```

## ğŸ“ˆ æ¨¡å‹æ¶æ„

### 1. è¡Œä¸ºåµŒå…¥æ¨¡å—
- **Node2Vec**: åŸºäºéšæœºæ¸¸èµ°çš„å›¾åµŒå…¥ï¼Œé€‚åˆå¤æ‚ç”¨æˆ·è¡Œä¸ºå›¾
- **Item2Vec**: åŸºäºSkip-gramçš„åºåˆ—åµŒå…¥ï¼Œé€‚åˆç®€å•åºåˆ—æ•°æ®

### 2. å±æ€§åµŒå…¥æ¨¡å—
- åˆ†ç±»ç‰¹å¾ï¼šåµŒå…¥å±‚ç¼–ç 
- æ•°å€¼ç‰¹å¾ï¼šæ ‡å‡†åŒ–å¤„ç†
- æ–‡æœ¬ç‰¹å¾ï¼šé¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ç¼–ç 

### 3. ä½ç½®åµŒå…¥æ¨¡å—
- åŸºäºItem2Vecçš„åŸºç«™åºåˆ—å»ºæ¨¡
- æ”¯æŒæ—¶é—´åºåˆ—ä½ç½®è½¨è¿¹

### 4. å¤šæ¨¡æ€èåˆç½‘ç»œ
- æ³¨æ„åŠ›æœºåˆ¶èåˆä¸åŒæ¨¡æ€
- æ®‹å·®è¿æ¥å’Œå±‚å½’ä¸€åŒ–
- ç”Ÿæˆæœ€ç»ˆç”¨æˆ·è¡¨ç¤ºå‘é‡

## ğŸ”§ é«˜çº§åŠŸèƒ½

### å®éªŒç®¡ç†
æ¯ä¸ªå®éªŒéƒ½æœ‰ç‹¬ç«‹çš„ç›®å½•å’Œé…ç½®ï¼š
```bash
# æŸ¥çœ‹å®éªŒé…ç½®
cat experiments/my_experiment/experiment_config.json

# æŸ¥çœ‹è®­ç»ƒæ—¥å¿—
cat experiments/my_experiment/logs/training.log

# æŸ¥çœ‹å…¼å®¹æ€§æŠ¥å‘Š
cat experiments/my_experiment/processed_data/new_user_compatibility_report.json
```

### æ¨¡å‹æ£€æŸ¥ç‚¹
è®­ç»ƒè¿‡ç¨‹ä¸­è‡ªåŠ¨ä¿å­˜æ£€æŸ¥ç‚¹ï¼Œæ”¯æŒæ–­ç‚¹ç»­è®­ï¼š
```bash
# ä»æ£€æŸ¥ç‚¹ç»§ç»­è®­ç»ƒ
python main.py --mode train --experiment_name my_experiment --resume_from_checkpoint
```

### ğŸ†• æ•°æ®è¿‡æ»¤æœºåˆ¶
ä¸ºäº†é¿å…æ–°ç”¨æˆ·æ•°æ®ä¸­åŒ…å«è®­ç»ƒæ—¶æœªè§è¿‡çš„å®ä½“å¯¼è‡´çš„é”™è¯¯ï¼š

1. **è®­ç»ƒé˜¶æ®µ**: è‡ªåŠ¨ä¿å­˜æ‰€æœ‰è®­ç»ƒæ•°æ®ä¸­å‡ºç°çš„URLå’ŒåŸºç«™IDåˆ° `training_entities.pkl`
2. **æ¨ç†é˜¶æ®µ**: åŠ è½½å®ä½“è®°å½•ï¼Œè¿‡æ»¤æ–°ç”¨æˆ·æ•°æ®ä¸­çš„æœªçŸ¥å®ä½“
3. **æŠ¥å‘Šç”Ÿæˆ**: è¯¦ç»†è®°å½•è¿‡æ»¤ç»Ÿè®¡å’Œæ•°æ®è´¨é‡åˆ†æ
4. **å»ºè®®æä¾›**: æ ¹æ®å…¼å®¹æ€§åˆ†ææä¾›å…·ä½“çš„æ”¹è¿›å»ºè®®

#### å…¼å®¹æ€§è¯„çº§è¯´æ˜
- **ä¼˜ç§€ (â‰¥80%)**: æ•°æ®å…¼å®¹æ€§å¾ˆå¥½ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨
- **è‰¯å¥½ (60-79%)**: æ•°æ®åŸºæœ¬å…¼å®¹ï¼Œä½†å»ºè®®æ£€æŸ¥æœªçŸ¥å®ä½“
- **ä¸€èˆ¬ (40-59%)**: æ•°æ®å…¼å®¹æ€§è¾ƒå·®ï¼Œå»ºè®®è¡¥å……è®­ç»ƒæ•°æ®
- **è¾ƒå·® (<40%)**: æ•°æ®å…¼å®¹æ€§å¾ˆå·®ï¼Œéœ€è¦é‡æ–°å‡†å¤‡æ•°æ®

## ğŸ› å¸¸è§é—®é¢˜

### Q: æ–°ç”¨æˆ·è®¡ç®—æ—¶å‡ºç° "KeyError" æˆ–ç»´åº¦ä¸åŒ¹é…ï¼Ÿ
A: è¿™é€šå¸¸æ˜¯å› ä¸ºæ–°ç”¨æˆ·æ•°æ®åŒ…å«è®­ç»ƒæ—¶æœªè§è¿‡çš„URLæˆ–åŸºç«™ã€‚ç°åœ¨ç³»ç»Ÿä¼šè‡ªåŠ¨è¿‡æ»¤è¿™äº›æ•°æ®å¹¶ç”ŸæˆæŠ¥å‘Šã€‚

### Q: å¦‚ä½•æé«˜æ•°æ®å…¼å®¹æ€§ï¼Ÿ
A: æŸ¥çœ‹ç”Ÿæˆçš„å…¼å®¹æ€§æŠ¥å‘Šï¼Œæ ¹æ®å»ºè®®ï¼š
1. å°†é‡è¦çš„æœªçŸ¥å®ä½“æ·»åŠ åˆ°è®­ç»ƒæ•°æ®ä¸­é‡æ–°è®­ç»ƒ
2. å°†æœªçŸ¥å®ä½“æ˜ å°„åˆ°ç›¸ä¼¼çš„å·²çŸ¥å®ä½“
3. æ£€æŸ¥æ•°æ®æ ¼å¼å’Œå‘½åè§„èŒƒçš„ä¸€è‡´æ€§

### Q: è®­ç»ƒè¿‡ç¨‹ä¸­å†…å­˜ä¸è¶³ï¼Ÿ
A: å‡å°‘æ‰¹é‡å¤§å°æˆ–åµŒå…¥ç»´åº¦ï¼š
```python
BATCH_SIZE = 128  # é»˜è®¤256
EMBEDDING_DIM = 64  # é»˜è®¤128
```

### Q: å¦‚ä½•è°ƒè¯•æ–°ç”¨æˆ·å‘é‡è®¡ç®—ï¼Ÿ
A: ä½¿ç”¨è°ƒè¯•æ¨¡å¼ï¼š
```bash
python compute_new_users.py --experiment_path experiments/your_experiment --debug
```

### Q: å…¼å®¹æ€§æŠ¥å‘Šæ˜¾ç¤ºè¯„åˆ†å¾ˆä½æ€ä¹ˆåŠï¼Ÿ
A: 
1. æ£€æŸ¥æ–°ç”¨æˆ·æ•°æ®çš„URLå’ŒåŸºç«™IDæ˜¯å¦ä¸è®­ç»ƒæ•°æ®ä¸€è‡´
2. è€ƒè™‘æ‰©å……è®­ç»ƒæ•°æ®é›†ï¼ŒåŒ…å«æ›´å¤šçš„URLå’ŒåŸºç«™
3. ä½¿ç”¨æ•°æ®æ˜ å°„ï¼Œå°†æœªçŸ¥å®ä½“æ˜ å°„åˆ°å·²çŸ¥çš„ç›¸ä¼¼å®ä½“

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.1.0 (æœ€æ–°)
- âœ… æ–°å¢è‡ªåŠ¨æ•°æ®è¿‡æ»¤æœºåˆ¶ï¼Œé¿å…æœªçŸ¥å®ä½“å¯¼è‡´çš„é”™è¯¯
- âœ… é›†æˆå…¼å®¹æ€§æŠ¥å‘Šç”Ÿæˆï¼Œè‡ªåŠ¨ä¿å­˜ä¸ºJSONæ ¼å¼
- âœ… æ–°å¢ç‹¬ç«‹çš„æ•°æ®å…¼å®¹æ€§æ£€æŸ¥å·¥å…· `check_new_user_data.py`
- âœ… ä¼˜åŒ–è¿‡æ»¤ç»Ÿè®¡å’ŒæŠ¥å‘Šå±•ç¤ºï¼Œæä¾›è¯¦ç»†çš„å…¼å®¹æ€§è¯„ä¼°
- âœ… å®Œå–„READMEæ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜
- âœ… æ·»åŠ å…¼å®¹æ€§è¯„çº§ç³»ç»Ÿå’Œæ”¹è¿›å»ºè®®

### v2.0.0
- âœ… å®Œæ•´çš„å¤šæ¨¡æ€ç”¨æˆ·åµŒå…¥ç³»ç»Ÿ
- âœ… æ”¯æŒNode2Vecå’ŒItem2Vecä¸¤ç§æ¨¡å‹
- âœ… æ–°ç”¨æˆ·å‘é‡è®¡ç®—åŠŸèƒ½
- âœ… å®éªŒç®¡ç†ç³»ç»Ÿ

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ï¼

---

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·æŸ¥çœ‹å…¼å®¹æ€§æŠ¥å‘Šæˆ–è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚
